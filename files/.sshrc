# Make nano the default editor.
export EDITOR="nano -w"

# Easier navigation: .., ..., ...., ....., ~ and -
alias ..='cd ..'         # Go up one directory
alias ...='cd ../..'     # Go up two directories
alias ....='cd ../../..' # Go up three directories
alias -- -='cd -'        # Go back
alias ~='cd ~'           # `cd` is probably faster to type though

# List files
alias ls='ls -F -G --color=auto --quoting-style=literal'
alias ll='ls -l --color=auto --quoting-style=literal'
alias la='ls -lA --color=auto --quoting-style=literal'
alias l1='ls -1 --color=auto --quoting-style=literal'
alias sl='ls'

# Prompt for confirmation
alias cp='cp -iv'
alias rm='rm -i'
alias mv='mv -iv'

# Other useful aliases
alias grep='grep --color=auto -in'

# Add edit alias
alias edit='$EDITOR'

BLACK=$(tput -Txterm-256color setaf 0)
RED=$(tput -Txterm-256color setaf 1)
GREEN=$(tput -Txterm-256color setaf 2)
YELLOW=$(tput -Txterm-256color setaf 3)
BLUE=$(tput -Txterm-256color setaf 4)
MAGENTA=$(tput -Txterm-256color setaf 5)
CYAN=$(tput -Txterm-256color setaf 6)
WHITE=$(tput -Txterm-256color setaf 7)
BOLD=$(tput -Txterm-256color bold)
RESET=$(tput -Txterm-256color sgr0)
# FIXME: These colours don't seem to fit Afterglow too well

# A function to allow cd ../../../.. to be cd ..... instead
cd() {
    if [[ "$1" =~ ^\.\.+$ ]]; then
        local a dir;
        a=${#1};

        while [ $a -ne 1 ]; do
            dir=${dir}"../";
            ((a--));
        done

        builtin cd $dir;
    else
        builtin cd "$@";
    fi
}

# Use /etc/is_vagrant_vm to test if vagrant and if so use yellow not red for the user/host
PROMPT_COLOR=$RED
if [ -f /etc/is_vagrant_vm ]; then
    PROMPT_COLOR=$YELLOW
fi

# Use a folder in home for bash git prompt unless it is installed in /opt or we are running in vagrant
GIT_PROMPT=$HOME/.bash-git-prompt
if [ -d /opt/bash-git-prompt ] || [ -f /etc/is_vagrant_vm ]; then
    GIT_PROMPT=/opt/bash-git-prompt
fi

if [ -f ${GIT_PROMPT}/gitprompt.sh ]; then
    GIT_PROMPT_ONLY_IN_REPO=0
    GIT_PROMPT_PREFIX=" ${RESET}on "
    GIT_PROMPT_SUFFIX="${RESET}"
    GIT_PROMPT_LEADING_SPACE=0
    GIT_PROMPT_SEPARATOR=' '
    GIT_PROMPT_BRANCH="${BLUE}"

    GIT_PROMPT_START="\n${PROMPT_COLOR}\u ${RESET}at ${PROMPT_COLOR}\h ${RESET}in ${MAGENTA}\w${RESET}"
    GIT_PROMPT_END="${RESET}\n\$ "

    source /opt/bash-git-prompt/gitprompt.sh
else
    function _parse_git_dirty() {
        [[ $(git status 2> /dev/null | tail -n1) != *"working directory clean"* ]] && echo "*"
    }

    function _parse_git_branch() {
        git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e "s/* \(.*\)/\1$(_parse_git_dirty)/"
    }

    function _install_git_prompt() {
        echo -e "\033[1;33m => Downloading bash-git-prompt\033[0m";
        sudo git clone https://github.com/magicmonty/bash-git-prompt.git $GIT_PROMPT --depth=1
        reset
        source $SSHHOME/sshrc.bashrc
        echo -e "\033[1;32m => bash-git-prompt setup!\033[0m";
    }

    echo -e "\033[1;31m => bash-git-prompt is not installed, run _install_git_prompt to install it\033[0m";

    export PS1="\n${PROMPT_COLOR}\u ${RESET}at ${PROMPT_COLOR}\h ${RESET}in ${MAGENTA}\w${RESET}\$([[ -n \$(git branch 2> /dev/null) ]] && echo \" on \")${BLUE}\$(_parse_git_branch)${RESET}\n$ ${RESET}"
    export PS2="> "
fi

# Check the window size after each command and, if necessary, update the values of LINES and COLUMNS.
shopt -s checkwinsize
